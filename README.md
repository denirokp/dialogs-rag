# üöÄ Dialogs RAG - –ê–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤ —Å –ø–æ–º–æ—â—å—é –ò–ò

RAG-–ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–∞–ª–æ–≥–æ–≤ —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–æ—Å—Ç–∞–≤–∫–µ, –±–∞—Ä—å–µ—Ä–∞—Ö, –∏–¥–µ—è—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Å–∏–≥–Ω–∞–ª–∞—Ö. –°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ChromaDB –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ OpenAI GPT-4o-mini –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—Å—Ç–∞.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîç **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫** - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –¥–∏–∞–ª–æ–≥–æ–≤
- ü§ñ **–ò–ò-–∞–Ω–∞–ª–∏–∑** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–∞—Ä—å–µ—Ä–æ–≤, –∏–¥–µ–π –∏ —Å–∏–≥–Ω–∞–ª–æ–≤
- üìä **15+ —Ç–∏–ø–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏** - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ 200+ —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏
- üí¨ **–¶–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤** - —Ç–æ—á–Ω—ã–µ —Ñ—Ä–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- üìà **–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –∞–Ω–∞–ª–∏–∑ —Ç—ã—Å—è—á –¥–∏–∞–ª–æ–≥–æ–≤ –∑–∞ —Ä–∞–∑
- üéØ **Self-check** - –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –∞–Ω–∞–ª–∏–∑–∞
- üá∑üá∫ **–†—É—Å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- OpenAI API –∫–ª—é—á (–¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞)
- Excel —Ñ–∞–π–ª —Å –¥–∏–∞–ª–æ–≥–∞–º–∏ (–∫–æ–ª–æ–Ω–∫–∏: `Id –∑–≤–æ–Ω–∫–∞`, `–¢–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏`)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/denirokp/dialogs-rag.git
cd dialogs-rag

# –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv .venv
source .venv/bin/activate     # Windows: .\.venv\Scripts\activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞
```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à OpenAI API –∫–ª—é—á
# OPENAI_API_KEY=sk-your-key-here
```

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
# –ü–æ–º–µ—Å—Ç–∏—Ç–µ –≤–∞—à Excel —Ñ–∞–π–ª –≤ –ø–∞–ø–∫—É data/
# –§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏: "Id –∑–≤–æ–Ω–∫–∞", "–¢–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏"
# –í —Ç–µ–∫—Å—Ç–µ –¥–∏–∞–ª–æ–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–æ–ª–∏: "–ö–ª–∏–µ–Ω—Ç:", "–û–ø–µ—Ä–∞—Ç–æ—Ä:"
```

### 4. –ó–∞–ø—É—Å–∫
```bash
# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
python ingest_excel.py

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑
python query.py "–û–ø—Ä–µ–¥–µ–ª–∏: –æ–±—Å—É–∂–¥–∞–ª–∞—Å—å –ª–∏ –¥–æ—Å—Ç–∞–≤–∫–∞, —Ç–∏–ø—ã, –±–∞—Ä—å–µ—Ä—ã, –∏–¥–µ–∏, —Å–∏–≥–Ω–∞–ª—ã."

# –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –¥–∏–∞–ª–æ–≥–æ–≤
python eval_batch.py
```

## üìä –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

### Excel —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
- **Id –∑–≤–æ–Ω–∫–∞** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–∏–∞–ª–æ–≥–∞
- **–¢–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏** - —Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞ —Å —Ä–æ–ª—è–º–∏

### –ü—Ä–∏–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞:
```
–ö–ª–∏–µ–Ω—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —Ö–æ—á—É –∑–∞–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä. –ö–∞–∫ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞–≤–∫–∞?
–û–ø–µ—Ä–∞—Ç–æ—Ä: –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –£ –Ω–∞—Å –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏.
–ö–ª–∏–µ–Ω—Ç: –ê —Å–∞–º–æ–≤—ã–≤–æ–∑ –≤–æ–∑–º–æ–∂–µ–Ω?
–û–ø–µ—Ä–∞—Ç–æ—Ä: –î–∞, –∫–æ–Ω–µ—á–Ω–æ!
```

## üéØ –ß—Ç–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º–∞

### –¢–∏–ø—ã –¥–æ—Å—Ç–∞–≤–∫–∏ (15+ –∫–∞—Ç–µ–≥–æ—Ä–∏–π):
- **–ü–í–ó** - –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏, –ø–æ—Å—Ç–∞–º–∞—Ç, —Å–∫–ª–∞–¥
- **–ö—É—Ä—å–µ—Ä—Å–∫–∞—è** - –¥–æ—Å—Ç–∞–≤–∫–∞ –Ω–∞ –¥–æ–º, –∫—É—Ä—å–µ—Ä—Å–∫–∞—è —Å–ª—É–∂–±–∞
- **–°–∞–º–æ–≤—ã–≤–æ–∑** - –∑–∞–±—Ä–∞—Ç—å —Å–∞–º, —Å–∞–º–æ–≤—ã–≤–æ–∑
- **–ü–æ—á—Ç–æ–≤–∞—è** - –ø–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏, —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä, –ø–æ—Å—ã–ª–∫–∞
- **–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å** - Ozon, Wildberries, –ê–≤–∏—Ç–æ
- **–≠–∫—Å–ø—Ä–µ—Å—Å** - —Å—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞, –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–µ–≥–æ–¥–Ω—è
- –ò –¥—Ä—É–≥–∏–µ...

### –ë–∞—Ä—å–µ—Ä—ã:
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ª–∏—Ñ—Ç–æ–º, —ç—Ç–∞–∂–æ–º
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä–∫–æ–≤–∫–∏
- –°–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º
- –ù–µ–ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

### –ò–¥–µ–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤:
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —Å–∫–∏–¥–∫–∞–º
- –ì—Ä—É–ø–ø–æ–≤—ã–µ –ø–æ–∫—É–ø–∫–∏
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏
- –£–ª—É—á—à–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞

### –°–∏–≥–Ω–∞–ª—ã:
- –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å, –ø—É—Ç–∞–Ω–∏—Ü–∞
- –ù–µ–∑–Ω–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –°–æ–º–Ω–µ–Ω–∏—è –≤ –≤—ã–±–æ—Ä–µ
- –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –ø–æ–º–æ—â–∏

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑:
```json
{
  "delivery_discussed": true,
  "delivery_types": ["–∫—É—Ä—å–µ—Ä—Å–∫–∞—è", "–ü–í–ó", "—Å–∞–º–æ–≤—ã–≤–æ–∑"],
  "barriers": ["–ª–∏—Ñ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç", "—Ç—è–∂–µ–ª—ã–π –¥–∏–≤–∞–Ω"],
  "ideas": ["—Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–µ"],
  "signals": ["–Ω–µ –ø–æ–Ω–∏–º–∞—é —Ä–∞–∑–Ω–∏—Ü—É"],
  "citations": [
    {"dialog_id": "call_001", "quote": "–ê –∫—É—Ä—å–µ—Ä–æ–º –º–æ–∂–Ω–æ?"}
  ]
}
```

### –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:
- **batch_results.csv** - —Å–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- **batch_results.jsonl** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ü–∏—Ç–∞—Ç–∞–º–∏

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `config.py`:

```python
@dataclass
class Settings:
    # –î–∞–Ω–Ω—ã–µ
    xlsx_path: str = "data/dialogs.xlsx"
    
    # –ö–æ–ª–æ–Ω–∫–∏ Excel
    col_id: str = "Id –∑–≤–æ–Ω–∫–∞"
    col_text: str = "–¢–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏"
    
    # –û–∫–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    prev_turns: int = 2  # —Ä–µ–ø–ª–∏–∫ –¥–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π
    next_turns: int = 2  # —Ä–µ–ø–ª–∏–∫ –ø–æ—Å–ª–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π
    
    # –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
    top_k: int = 8  # —Å–∫–æ–ª—å–∫–æ –æ–∫–æ–Ω –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ LLM
    
    # LLM
    use_openai: bool = True
    openai_model: str = "gpt-4o-mini"
```

## üîß –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### –° OpenAI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```bash
# –í .env —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤–∞—à API –∫–ª—é—á
OPENAI_API_KEY=sk-your-key-here
```

### –ë–µ–∑ OpenAI (–∑–∞–≥–ª—É—à–∫–∞):
```python
# –í config.py —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ
use_openai: bool = False
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
dialogs-rag/
‚îú‚îÄ‚îÄ data/                   # Excel —Ñ–∞–π–ª—ã —Å –¥–∏–∞–ª–æ–≥–∞–º–∏
‚îú‚îÄ‚îÄ chroma_db/             # –í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ .env                   # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å–æ–∑–¥–∞—Ç—å –∏–∑ .env.example)
‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ prompts.py             # –ü—Ä–æ–º–ø—Ç—ã —Å –≥–ª–æ—Å—Å–∞—Ä–∏–µ–º
‚îú‚îÄ‚îÄ ingest_excel.py        # –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ query.py               # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
‚îú‚îÄ‚îÄ eval_batch.py          # –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îî‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. —Ñ–∞–π–ª LICENSE

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [Issues](https://github.com/denirokp/dialogs-rag/issues)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Issue —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã
3. –ü—Ä–∏–ª–æ–∂–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏)

---

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–∞–ª–æ–≥–æ–≤**

#!/usr/bin/env python3
"""
Промпты и конфигурация для анализа диалогов
"""

from pathlib import Path

# Загрузка промптов из файлов
def load_prompt(filename: str) -> str:
    """Загрузка промпта из файла"""
    prompt_file = Path("prompts") / filename
    if prompt_file.exists():
        return prompt_file.read_text(encoding="utf-8")
    else:
        return ""

# Промпт для детекции доставки
DELIVERY_DETECTION_PROMPT = """
Роль: Аналитик диалогов.

Определи, обсуждалась ли в диалоге тема доставки товаров.

Ключевые слова доставки:
- доставка, доставить, привезти, принести
- курьер, курьерская доставка
- самовывоз, забрать сам
- ПВЗ, пункт выдачи
- почта, почтовая доставка
- СДЭК, Яндекс Доставка, Avito Доставка
- сроки доставки, время доставки
- стоимость доставки, цена доставки
- проблемы с доставкой, не работает доставка
- настройка доставки, подключить доставку

Ответь в формате JSON:
{"delivery_discussed": true/false, "p_deliv": 0.0-1.0}
"""

# Промпт для извлечения сущностей (базовый)
ENTITY_EXTRACTION_PROMPT = load_prompt("extract_entities.txt")

# Промпт для извлечения сущностей (улучшенный)
ENTITY_EXTRACTION_ENHANCED_PROMPT = load_prompt("extract_entities_enhanced.txt")

# Промпт для кластеризации
CLUSTER_LABELING_PROMPT = load_prompt("cluster_labeling.txt")

# Промпт для генерации отчетов
REPORT_SUMMARY_PROMPT = load_prompt("report_summary.txt")

# Ключевые слова доставки
DELIVERY_KEYWORDS = [
    "доставка", "доставить", "привезти", "принести",
    "курьер", "курьерская", "самовывоз", "забрать",
    "пвз", "пункт выдачи", "почта", "почтовая",
    "сдэк", "яндекс доставка", "avito доставка",
    "сроки доставки", "время доставки", "стоимость доставки",
    "проблемы с доставкой", "настройка доставки"
]

# Ключевые слова платформ
PLATFORM_KEYWORDS = {
    "avito": ["avito", "авито", "avito доставка"],
    "сдэк": ["сдэк", "сдек", "сдэк доставка"],
    "яндекс": ["яндекс", "яндекс доставка", "яндекс.доставка"],
    "почта": ["почта россии", "почтовая доставка", "почта"],
    "курьер": ["курьерская доставка", "курьер", "курьером"]
}

# Стоп-слова для кластеризации
CLUSTERING_STOPWORDS = {
    "и", "в", "во", "не", "что", "он", "на", "я", "с", "со", "как", "а", "то", "все", "она", "так", "его", "но", "да", "ты", "к", "у", "же", "вы", "за", "бы", "по", "только", "ее", "мне", "было", "вот", "от", "меня", "еще", "нет", "о", "из", "ему", "теперь", "когда", "даже", "ну", "вдруг", "ли", "если", "уже", "или", "ни", "быть", "был", "него", "до", "вас", "нибудь", "опять", "уж", "вам", "ведь", "там", "потом", "себя", "ничего", "ей", "может", "они", "тут", "где", "есть", "надо", "ней", "для", "мы", "тебя", "их", "чем", "была", "сам", "чтоб", "без", "будто", "чего", "раз", "тоже", "себе", "под", "будет", "ж", "тогда", "кто", "этот", "того", "потому", "этого", "какой", "совсем", "ним", "здесь", "этом", "один", "почти", "мой", "тем", "чтобы", "нее", "сейчас", "были", "куда", "зачем", "всех", "никогда", "можно", "при", "наконец", "два", "об", "другой", "хоть", "после", "над", "больше", "тот", "через", "эти", "нас", "про", "всего", "них", "какая", "много", "разве", "три", "эту", "моя", "впрочем", "хорошо", "свою", "этой", "перед", "иногда", "лучше", "чуть", "том", "нельзя", "такой", "им", "более", "всегда", "конечно", "всю", "между"
}

# Конфигурация этапов
STAGE_CONFIG = {
    "small_sample_threshold": 50,
    "show_ids_limit": 5,
    "rare_threshold": 3,
    "max_quotes_per_cluster": 3,
    "min_quote_length": 10,
    "max_quote_length": 200
}

# Карта нормализации для stage3
NORMALIZATION_MAP = {
    "барьеры": {
        "технические": ["непонимание процесса", "проблемы с настройками", "сбои системы", "не работает интерфейс"],
        "финансовые": ["высокая стоимость", "скрытые платежи", "неожиданные расходы", "дорого доставлять"],
        "логистические": ["мало ПВЗ", "недоступность в регион", "долгие сроки", "плохая доставка"],
        "качественные": ["повреждение товара", "неправильная упаковка", "потеря посылки", "некачественная доставка"],
        "процессные": ["сложный возврат", "плохая коммуникация", "неясные условия", "неудобный процесс"]
    },
    "идеи": {
        "UX/UI": ["единая кнопка выбора", "упростить интерфейс", "добавить подсказки", "улучшить навигацию"],
        "функциональные": ["примерка перед покупкой", "предварительный расчет", "уведомления", "отслеживание"],
        "логистические": ["больше ПВЗ", "экспресс-доставка", "выбор времени", "гибкие опции"],
        "финансовые": ["субсидирование", "скидки за объем", "бесплатная доставка", "прозрачное ценообразование"]
    },
    "сигналы": {
        "предпочтения": ["только Avito Доставка", "люблю самовывоз", "доверяю СДЭК", "предпочитаю курьера"],
        "паттерны": ["часто заказываю", "редко пользуюсь", "только для дорогих товаров", "сезонные покупки"],
        "мотивации": ["скорость важнее цены", "цена важнее скорости", "удобство превыше всего", "надежность"]
    }
}